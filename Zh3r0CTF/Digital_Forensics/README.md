# Zh3r0 CTF Digital Forensics
## PreDestination
>MR.Zh3r0 is a mathematician who loves what he does, he loves music and of course he is really good with personal desktops but a really gullible person who could be phished or scammed easily! He had some bad colleagues in his office that led him to have some bad intentions towards them. One of his “HECKER” friend suggested to download some virus to destroy the data the other people has. As you would expect, this backfired. He has called the World’s best forensics experts to come to his rescue! We were fortunately able to get his PC’s image and some of the files in it. And We have a suspicion if he only downloaded one malware or more than one? And we need answers to some questions that follow, this would be your first assignment! .We found that his PC had some sort of problem with Time Zones even though he tries to reset it, it seems the malware is somehow able to edit the TimeZone to what it wants, which is the malware author name. How could a malware edit the TimeZone information if it had Administrator Privilege to the system!?

>Download: image.e01

This challenge is asking for the player to take an Encase Image file, and extract the timezone from it. To begin this process, let's open it in [autopsy](https://www.autopsy.com/).

Once the image is open, we can do some initial recon on the image. After running the initial ingress processing, we can go to ``Results > Operating System Information`` to see that the image is taken from a Windows XP Service Pack 1 machine. This information will help us in future challenges, as well as in getting a starting point for finding the Timezone information to solve this challenge. After some research, I encountered a [forum post](https://social.technet.microsoft.com/Forums/en-US/24391355-1ebf-468a-a1a8-8b74ad794f76/time-zone-registry-key) stating the timezone could be found in the registry key ``HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\TimeZoneInformation``. To access this key, we can go to the main volume of the image (volume 2 in my case), then travel to the file located at ``WINDOWS\system32\config\system``. With this registry file, we simply view the key located at ``CurrentControlSet01\Control\TimeZoneInformation\StandardName``. Viewing this key gives us the value ``Cicada3310`` for a final flag of ``zh3r0{Cicada3310}``

## Good Ol’ IE
>We haven’t found the trace of how the virus could have got into the system. There are several attack vectors that a malware could get into the system which you will need to find. Now the question is, find the most probable way the malware(s) could’ve got in and the flag would be the name of the source.

This challenge stumped me for a while, since it was so vauge, but a solution is clear once you realize you are simply looking for a probable infection source, and not a proven one. To begin, we utilize the challenge name to determine that the challenge will likely be based around Internet Explorer, and begin searching for artifacts there. While researching, I came across [this article](https://www.digitalforensics.com/blog/an-overview-of-web-browser-forensics/) which showcases a lot of files and registry keys that contain IE artifacts. Browsing these, we can find some URLs visted by the Administrator user, as well as some cached images, but the real value comes from reading the registry keys located in the Administrator user's NTUSER.dat file. Inside of this file, located at ``volume\Documents and Settings\Administrator\NTUSER.dat`` we can find the registry keys url1-url14 inside of ``Software\Microsoft\Internet Explorer\TypedURLs``. Viewing the url11 key gives the value ``http://w3.you-got-million-dollars-click-me.nr.hg.org.tech/`` which making our final flag ``zh3r0{http://w3.you-got-million-dollars-click-me.nr.hg.org.tech/}``

## UnRemovable
> Now, that you have found out how the malware got in, the next question is to find what the malware’s name is, we have got a lead though, we found out that the virus wasn’t removable from the system even after a system. Although it hasn’t been identified at a particular location, something is triggering it to restart as soon as he logs in! How could this happen? If you find the reason or the method for the above mentioned phenomenon you will find the flag there as an obvious one.

With this challenge, it is clear that malware is being executed when the user logs in, the trick is simply to determine how. Upon researching this, I found a [forum post](https://superuser.com/questions/181828/where-is-the-startup-folder-in-windows-xp-professional-sp3) that lists many different locations that could cause this startup activity, including startup folders such as ``%AllUsersProfile%\Start Menu\Startup``, ``%UserProfile%\Start Menu\Startup``, registry keys such as ``HKey_Local_Machine\Software\Microsoft\Windows\CurrentVersion\Run*``, ``HKey_Current_User\Software\Microsoft\Windows\CurrentVersion\Run*``, as well as the registry key needed for this challenge: ``HKey_Local_Machine\Software\Microsoft\Windows NT\CurrentVersion\WinLogon\Shell``. While looking at each of these registry keys, we will notice an ``execute`` run key that is not related to this challenge with the value ``C:\windows\Program Files(x86)\Anubis.exe``, this will be used in a later challenge, but doing extensive research has shown it to us early. Viewing the ``HKey_Local_Machine\Software\Microsoft\Windows NT\CurrentVersion\WinLogon\Shell`` key gives us the value ``Explorer.exe%system%/zh3r0ctfmalware.exe``, for a final flag of ``zh3r0{zh3r0ctfmalware.exe}``

## Soundless
> Good job in finding the flag! We have found traces of yet another malware! The information we have is that MR.Zh3r0’s music folder isn’t really a music folder,(i.e), he’s music folder seems to trigger the virus software somehow whenever he clicks it! Now he can’t even open his default music folder to hear some good musics! We have a certain idea that somehow the virus might be redirecting the clicks to a different location where the virus resides or the location of music folder could be compltely different! You can find the flag at the right place when you look, it will be obvoius when u look at it!

This challenge is indicating that the music folder for Zh3r0's account is somehow replaced with malware, but the question is how. When playing this CTF, I stumbled on the answer acidentally by searching for the string zh3r0. To solve the solution this way, simple go to the top right in autopsy, select keyword search, and search for the substring ``zh3ro``. Browsing through the matches will showcase the Administrator user's NTUSER.dat file, showing the indexed text ``C:\Users\zh3r0\Documents\Hades.exe`` right above the indexed text ``ator\My Documents\My Music``. This leads us to exploring the NTUSER.dat file closer, looking for this key, which we eventually find at ``Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders\My Music`` with the key ``C:\Users\zh3r0\Documents\Hades.exe`` for a final flag of ``zh3r0{C:\Users\zh3r0\Documents\Hades.exe}``

## Run Forrest Run
> Just like one other malware you found, we found traces of another malware which is able to start itself without user intervention, but this time we have no idea or info on when it starts or what triggers it, we only know that it runs automatically! If you have found out all the other flags then this one would be easy for you, this is a test of how much you know about forensics and where to look at properly!

Remember that run key we already discovered? Viewing the run key at ``HKey_Local_Machine\Software\Microsoft\Windows\CurrentVersion\Run\execute`` gives us the value ``C:\windows\Program Files(x86)\Anubis.exe`` for a final flag of ``zh3r0{C:\windows\Program Files(x86)\Anubis.exe}``
